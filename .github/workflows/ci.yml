name: CI

on:
  pull_request:

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dbt (local checks)
        run: |
          pip install --no-cache-dir dbt-core==1.10.3 dbt-bigquery==1.10.3
          dbt --version

      - name: dbt deps + parse/compile
        env:
          DBT_PROFILES_DIR: ./profiles
          PROJECT_ID: dummy
          DATASET: dummy
          BQ_LOCATION: EU
        run: |
          dbt deps || true
          dbt parse
          dbt compile

      - name: Docker build (no push)
        run: |
          docker build -t dbt-ci:pr .
